<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  
  <title>Mario Maker</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/qf.css">

  <!-- Bullet-proof centering shell (inline so it always wins) -->
  <style>
    /* Fullscreen shell that respects safe areas and centers content */
    #stage-center {
      position: fixed;
      left: 0;
      inset: 0;                   /* full viewport */
      display: block;             /* leave as-is if you don't want grid centering */
      /* place-items: center; */   /* perfect center on both axes (needs display:grid) */
      width: auto;
      height: 100dvh;             /* handles mobile URL bars; fallbacks below */
      min-height: 100svh;
      z-index: 50;
    }

    /* Fixed-size stage that we scale */
    #scale-root {
      width: auto;
      height: 30px;               /* 50 score + 480 canvas (keep your value if intentional) */
      transform: scale(var(--mm-scale, 1));
      transform-origin: center center;
      will-change: transform;

      /* keep internal content perfectly centered too */
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;

      /* avoids subpixel blur on some mobile GPUs */
      backface-visibility: hidden;
      -webkit-transform: translateZ(0) scale(var(--mm-scale, 1));
    }

    /* HARD DISABLE touch/pointer interaction on the game canvas */
    .game-screen {
      pointer-events: none;          /* canvas won't receive clicks/touches */
      touch-action: none;            /* disable browser gestures within its box */
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
  </style>
</head>

<body>

  <!-- Portrait fallback overlay -->
  <div id="rotate-overlay" class="rotate-overlay" style="display:none">
    Please rotate your device to landscape for the best experience!
  </div>

  <!-- Centering shell + scalable stage -->
  <div id="scale-root">
    <div class="main-wrapper">
      <canvas class="game-screen"></canvas> 
    </div>
  </div>

  <!-- on-screen touch controls (mobile only) -->
  <div class="mobile-controls">
    <div class="nav-buttons">
      <button id="btn-left"  class="control-btn">◀</button>
      <button id="btn-right" class="control-btn">▶</button>
    </div>
    <button id="btn-jump" class="control-btn">⏫</button>
  </div>

  <!-- Scripts -->
  <script src="js/View.js"></script>
  <script src="js/GameUI.js"></script>

  <script src="js/mainGame/GameSound.js"></script>
  <script src="js/mainGame/Element.js"></script>
  <script src="js/mainGame/PowerUp.js"></script>
  <script src="js/mainGame/Enemy.js"></script>
  <script src="js/mainGame/Bullet.js"></script>
  <script src="js/mainGame/Mario.js"></script>
  <script src="js/mainGame/Score.js"></script>
  <script src="js/mainGame/MarioGame.js"></script>

  <script src="js/levelEditor/Storage.js"></script>
  <script src="js/levelEditor/Editor.js"></script>
  <script src="js/levelEditor/CreatedLevels.js"></script>

  <!-- Question Flow -->
  <script src="js/QuestionFlow.js"></script>

  <script src="js/MilestoneScreen.js"></script>

  <script src="js/MarioMaker.js"></script>

  <!-- Fit-to-screen scaler (must load before Preloader) -->
  <script src="js/Scaler.js"></script>

  <script src="js/Preloader.js"></script>

  <script>
    // Lock to landscape when allowed
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock('landscape').catch(function(err){
        console.warn('Orientation lock failed:', err);
      });
    }

    // Show “rotate” overlay if still in portrait on phones/tablets
    function checkOrientation() {
      const overlay = document.getElementById('rotate-overlay');
      if (window.matchMedia("(orientation: portrait) and (max-width: 1024px)").matches) {
        overlay.style.display = 'flex';
      } else {
        overlay.style.display = 'none';
      }
    }

    window.addEventListener('orientationchange', checkOrientation, { passive: true });
    window.addEventListener('resize', checkOrientation, { passive: true });
    document.addEventListener('visibilitychange', checkOrientation, { passive: true });
    checkOrientation();

    // ======= TOUCH/PTR/MOUSE GUARD: disable any input inside the canvas rect =======
    (function touchBlocker() {
      const canvas = document.querySelector('canvas.game-screen');
      if (!canvas) return;

      function inCanvas(clientX, clientY) {
        const r = canvas.getBoundingClientRect();
        return clientX >= r.left && clientX <= r.right && clientY >= r.top && clientY <= r.bottom;
      }

      function kill(ev) {
        let x, y;

        if (ev.type.startsWith('touch')) {
          const t = ev.touches[0] || ev.changedTouches[0];
          if (!t) return;
          x = t.clientX; y = t.clientY;
        } else if ('clientX' in ev && 'clientY' in ev) {
          x = ev.clientX; y = ev.clientY;
        } else {
          return;
        }

        if (inCanvas(x, y)) {
          ev.preventDefault();
          ev.stopPropagation();
          if (typeof ev.stopImmediatePropagation === 'function') ev.stopImmediatePropagation();
          return false;
        }
      }

      const opts = { capture: true, passive: false };
      [
        'touchstart','touchmove','touchend','touchcancel',
        'pointerdown','pointermove','pointerup','pointercancel',
        'mousedown','mousemove','mouseup','click','dblclick','contextmenu'
      ].forEach(type => {
        window.addEventListener(type, kill, opts);
      });
    })();
  </script>

</body>
</html>
